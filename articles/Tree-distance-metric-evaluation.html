<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tree distance metric evaluation • Quartet</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Tree distance metric evaluation">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Quartet</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.2.9002</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Critical-distances.html">Interpreting large quartet distances</a>
    </li>
    <li>
      <a href="../articles/Tree-distance-metric-evaluation.html">Tree distance metric evaluation</a>
    </li>
    <li>
      <a href="../articles/Tree-distance-metrics.html">Tree distance metrics</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ms609/Quartet">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Tree distance metric evaluation</h1>
                        <h4 class="author">Martin R. Smith</h4>
            
            <h4 class="date">2019-11-21</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ms609/Quartet/blob/master/vignettes/Tree-distance-metric-evaluation.Rmd"><code>vignettes/Tree-distance-metric-evaluation.Rmd</code></a></small>
      <div class="hidden name"><code>Tree-distance-metric-evaluation.Rmd</code></div>

    </div>

    
    
<p>Tree distance metrics are introduced in an <a href="tree-distance-metrics.html">earlier vignette</a>.</p>
<pre><code>## 
## Attaching package: 'Quartet'</code></pre>
<pre><code>## The following object is masked from 'package:TreeDist':
## 
##     RobinsonFoulds</code></pre>
<div id="desired-behaviour-of-tree-distance-metrics" class="section level1">
<h1 class="hasAnchor">
<a href="#desired-behaviour-of-tree-distance-metrics" class="anchor"></a>Desired behaviour of tree distance metrics</h1>
<p>The most fundamental desideratum for a tree distance metric is that it assigns higher distance scores (or lower similarity scores) to trees that are more different. A consideration of problematic cases shows that some metrics do not consistently meet this fundamental criterion.</p>
<div id="moving-a-single-taxon" class="section level2">
<h2 class="hasAnchor">
<a href="#moving-a-single-taxon" class="anchor"></a>Moving a single taxon</h2>
<p>If trees differ only in the location of a single taxon (see taxon 1 in the trees below), then the distance between two trees should correspond to the distance that this taxon has been moved.</p>
<p><img src="Tree-distance-metric-evaluation_files/figure-html/Moving-a-single-taxon-1.png" width="100%"></p>
<p>The subtree pruning and regrafting (SPR) distance does not distinguish between these trees, as they differ only in the placement of a single tip. The Robinson-Foulds, path difference and quartet metrics, in contrast, recognize trees in which this tip has been moved further as more distant from the starting tree.</p>
<table class="table">
<thead><tr class="header">
<th>Measure</th>
<th>Quartet</th>
<th>Path</th>
<th>SPR</th>
<th>RF</th>
<th>MS</th>
<th>Nye <em>et al.</em>
</th>
<th>MClInf</th>
<th>MArInf</th>
<th>VoArInf</th>
</tr></thead>
<tbody><tr class="odd">
<td>Outcome</td>
<td><strong>Pass</strong></td>
<td><strong>Pass</strong></td>
<td><span style="color:red"><strong>FAIL</strong></span></td>
<td><span style="color:red"><strong>FAIL</strong></span></td>
<td><strong>Pass</strong></td>
<td><strong>Pass</strong></td>
<td><strong>Pass</strong></td>
<td><strong>Pass</strong></td>
<td><strong>Pass</strong></td>
</tr></tbody>
</table>
</div>
<div id="moving-two-taxa" class="section level2">
<h2 class="hasAnchor">
<a href="#moving-two-taxa" class="anchor"></a>Moving two taxa</h2>
<p>Intuitively, moving a pair of tips on a tree should lead to higher tree distances than moving a single tip. In the case of a short move, the RF distance does not differ whether one or two tips are moved. For larger moves, however, the RF distance is <em>less</em> when two tips are moved than when a single tip is moved. The path and quartet metrics perform as expected.</p>
<p>The trees below differ from a reference tree in the position of a single tip (tip 1), or a pair of tips (tips 10 and 11), which have been moved a short, medium or long distance from their original positions.</p>
<p><img src="Tree-distance-metric-evaluation_files/figure-html/Moving-a-cherry-1.png" width="66%" style="display: block; margin: auto;"></p>
<table class="table">
<thead><tr class="header">
<th>Measure</th>
<th>Quartet</th>
<th>Path</th>
<th>SPR</th>
<th>RF</th>
<th>MS</th>
<th>Nye <em>et al.</em>
</th>
<th>MClInf</th>
<th>MArInf</th>
<th>VoArInf</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Short move</td>
<td><strong>Pass</strong></td>
<td><strong>Pass</strong></td>
<td><span style="color:red"><strong>FAIL</strong></span></td>
<td><span style="color:red"><strong>FAIL</strong></span></td>
<td><strong>Pass</strong></td>
<td><strong>Pass</strong></td>
<td><strong>Pass</strong></td>
<td><strong>Pass</strong></td>
<td><strong>Pass</strong></td>
</tr>
<tr class="even">
<td>Medium move</td>
<td><strong>Pass</strong></td>
<td><strong>Pass</strong></td>
<td><span style="color:red"><strong>FAIL</strong></span></td>
<td><span style="color:red"><strong>FAIL</strong></span></td>
<td><span style="color:red"><strong>FAIL</strong></span></td>
<td><span style="color:red"><strong>FAIL</strong></span></td>
<td><strong>Pass</strong></td>
<td><strong>Pass</strong></td>
<td><strong>Pass</strong></td>
</tr>
<tr class="odd">
<td>Long move</td>
<td><strong>Pass</strong></td>
<td><strong>Pass</strong></td>
<td><span style="color:red"><strong>FAIL</strong></span></td>
<td><span style="color:red"><strong>FAIL</strong></span></td>
<td><span style="color:red"><strong>FAIL</strong></span></td>
<td><span style="color:red"><strong>FAIL</strong></span></td>
<td><strong>Pass</strong></td>
<td><strong>Pass</strong></td>
<td><strong>Pass</strong></td>
</tr>
</tbody>
</table>
</div>
<div id="maximum-distance" class="section level2">
<h2 class="hasAnchor">
<a href="#maximum-distance" class="anchor"></a>Maximum distance</h2>
<p>A distance metric should distinguish slightly-perturbed trees from random trees and those that are more different from the starting tree than expected by chance.</p>
<p>The Robinson-Foulds metric can reach its maximum value when a single taxon is relocated from the most basal to the most derived point of a pectinate tree, representing a maximal value despite retaining relationship information about all other taxa.</p>
<p><img src="Tree-distance-metric-evaluation_files/figure-html/Pectinate-to-break-RF-1.png" width="576" style="display: block; margin: auto;"></p>
<table class="table">
<thead><tr class="header">
<th>Criterion</th>
<th>Quartet</th>
<th>Path</th>
<th>SPR</th>
<th>RF</th>
<th>MS</th>
<th>Nye <em>et al.</em>
</th>
<th>MClInf</th>
<th>MArInf</th>
<th>VoArInf</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Swap 2 &gt; Move 1</td>
<td><strong>Pass</strong></td>
<td><strong>Pass</strong></td>
<td><strong>Pass</strong></td>
<td><span style="color:red"><strong>FAIL</strong></span></td>
<td><span style="color:red"><strong>FAIL</strong></span></td>
<td><strong>Pass</strong></td>
<td><strong>Pass</strong></td>
<td><strong>Pass</strong></td>
<td><strong>Pass</strong></td>
</tr>
<tr class="even">
<td>Random &gt; Swap 2</td>
<td><strong>Pass</strong></td>
<td><strong>Pass</strong></td>
<td><strong>Pass</strong></td>
<td><span style="color:red"><strong>FAIL</strong></span></td>
<td><strong>Pass</strong></td>
<td><strong>Pass</strong></td>
<td><strong>Pass</strong></td>
<td><span style="color:red"><strong>FAIL</strong></span></td>
<td><span style="color:red"><strong>FAIL</strong></span></td>
</tr>
<tr class="odd">
<td>Contra &gt; Random</td>
<td><strong>Pass</strong></td>
<td><strong>Pass</strong></td>
<td><span style="color:red"><strong>FAIL</strong></span></td>
<td><span style="color:red"><strong>FAIL</strong></span></td>
<td><strong>Pass</strong></td>
<td><strong>Pass</strong></td>
<td><strong>Pass</strong></td>
<td><strong>Pass</strong></td>
<td><strong>Pass</strong></td>
</tr>
</tbody>
</table>
<p>A notable proportion of random trees receive a lower RF distance from the original tree, even though they do not show any structural similarity. This is not the case with the quartet symmetric difference.</p>
<p><img src="Tree-distance-metric-evaluation_files/figure-html/Random-trees-1.png" width="80%" style="display: block; margin: auto;"></p>
<p>An advantage of the quartet symmetric distance is that the normalized metric of a random tree is <span class="math inline">\(\frac{2}{3}\)</span> <span class="citation">(Day, 1986; Steel &amp; Penny, 1993)</span>. As such, trees that are more different than expected by chance can be readily recognized, as their distance metric will be greater than <span class="math inline">\(\frac{220}{330}\)</span>. The ‘maximum distance’ tree depicted below was identified using the R package <code>TreeSearch</code> <span class="citation">(Smith, 2018)</span>, using the quartet difference from the reference tree as an optimality criterion.</p>
<p><img src="Tree-distance-metric-evaluation_files/figure-html/Increasing-distances-1.png" width="90%" style="display: block; margin: auto;"></p>
</div>
<div id="unit-equivalence" class="section level2">
<h2 class="hasAnchor">
<a href="#unit-equivalence" class="anchor"></a>Unit equivalence</h2>
<p>A further shortcoming of the RF metric is that not all partitions represent an equivalent amount of information. A partition distance of 1 could mean that two trees differ in an uninformative partition, or a more informative partition. All quartets, in contrast, are equally informative.</p>
<p>Consider a balanced and an unbalanced eight-taxon tree:</p>
<p><img src="Tree-distance-metric-evaluation_files/figure-html/two-trees-1.png" width="576"></p>
<p>Each tree divides the eight taxa into five bipartition splits.<br>
The information content (Shannon entropy) of a split can be calculated based on what proportion of eight-tip trees contain the split in question. This is a function of the evenness of the split:</p>
<table class="table">
<thead><tr class="header">
<th></th>
<th align="right">Matching trees</th>
<th align="right">p(Match in random tree)</th>
<th align="right">Information content / bits</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Partition size: 2:6</td>
<td align="right">945</td>
<td align="right">0.0909</td>
<td align="right">3.459432</td>
</tr>
<tr class="even">
<td>Partition size: 3:5</td>
<td align="right">315</td>
<td align="right">0.0303</td>
<td align="right">5.044394</td>
</tr>
<tr class="odd">
<td>Partition size: 4:4</td>
<td align="right">225</td>
<td align="right">0.0216</td>
<td align="right">5.529821</td>
</tr>
</tbody>
</table>
<p>In the first tree, split 1 is even, dividing four taxa from four others (<code>4:4</code>); splits 2–5 are maximally uneven (<code>2:6</code>). The total information content of these five splits is 19.37, whereas that of the five splits in the second tree, of sizes <code>2:6</code>, <code>3:5</code>, <code>4:4</code>, <code>3:5</code> and <code>2:6</code>, is 22.54. Put another way, a random tree will on average share more partitions with the balanced tree (whose partitions are predominantly uneven and thus likely to be matched) than the asymmetric tree (which contains more even partitions that are less likely to occur in a random tree).</p>
<p>Of the 10 395 eight-tip trees, many more bear at least one partition in common with a balanced tree than with an asymmetric tree, whereas the distribution of quartets is identical:</p>
<p><img src="Tree-distance-metric-evaluation_files/figure-html/all-8-tip-trees-1.png" width="700"></p>
</div>
<div id="unresolved-trees" class="section level2">
<h2 class="hasAnchor">
<a href="#unresolved-trees" class="anchor"></a>Unresolved trees</h2>
<p>Whereas the path distance and SPR metrics are only defined on bifurcating trees, symmetric difference approaches can be applied to trees that contain polytomies – i.e. not every node is resolved as bifurcating.</p>
</div>
<div id="conclusion" class="section level2">
<h2 class="hasAnchor">
<a href="#conclusion" class="anchor"></a>Conclusion</h2>
<p>Quartet dissimilarity is the only available metric of tree distance that fulfils all of the following desiderata:</p>
<ul>
<li>Allocates trees higher distances if a clade moves greater distances</li>
<li>Allocates trees higher distances if a the clade that is moved is larger</li>
<li>Distinguishes contradicted from unresolved information in trees that are not fully bifurcating (resolved)</li>
<li>Identifies pairs of trees that are more random than expected by chance</li>
<li>Does not reach its maximum value after relatively trivial rearrangements</li>
</ul>
</div>
</div>
<div id="improvements-to-partition-metrics" class="section level1">
<h1 class="hasAnchor">
<a href="#improvements-to-partition-metrics" class="anchor"></a>Improvements to partition metrics</h1>
<p>The primary issue with the Robinson-Foulds distance is its conservative pairing of clades: a grouping is either identical in both trees, or is treated as different.<br>
This makes no account for the possibility that one tree contains a grouping that is similar (though not quite identical) to a grouping in another.</p>
<p>In order to incorporate some measure of similar-but-not-quite-identical clades, it is necessary to construct an optimal matching that pairs each clade in each tree with either a suitable clade in the other, or with no clade at all.</p>
<p>Various approaches to this problem have been proposed; these typically search for a matching that minimises the total dissimilarity summed for all pairings. Approaches differ in how they penalize differences between paired groups. Bogdanowicz and Giaro <span class="citation">(2012, 2013, 2017)</span> calculate the size of the largest bipartition that is consistent with both input groups; Nye <em>et al</em>. <span class="citation">(2006)</span> normalize this number using the Jaccard index; Böcker <em>et al</em>. <span class="citation">(2013)</span> raise this value to an arbitrary exponent, and add a constraint that prohibits pairings that comprise contradictory groups.</p>
<p>These approaches represent a refinement of the Robinson-Foulds metric, circumventing many of the issues raised above. They are, however, more computationally expensive, and lack an objective measure of clade similarity. I am not presently aware of an R implementation of any of these measures, though a related metric is planned for a future version of this package.</p>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-Bogdanowicz2012">
<p>Bogdanowicz, D., &amp; Giaro, K. (2012). Matching split distance for unrooted binary phylogenetic trees. <em>IEEE/ACM Transactions on Computational Biology and Bioinformatics</em>, <em>9</em>(1), 150–160. doi: <a href="https://doi.org/10.1109/TCBB.2011.48">10.1109/TCBB.2011.48</a></p>
</div>
<div id="ref-Bogdanowicz2013">
<p>Bogdanowicz, D., &amp; Giaro, K. (2013). On a matching distance between rooted phylogenetic trees. <em>International Journal of Applied Mathematics and Computer Science</em>, <em>23</em>(3), 669–684. doi: <a href="https://doi.org/10.2478/amcs-2013-0050">10.2478/amcs-2013-0050</a></p>
</div>
<div id="ref-Bogdanowicz2017">
<p>Bogdanowicz, D., &amp; Giaro, K. (2017). Comparing phylogenetic trees by matching nodes using the transfer distance between partitions. <em>Journal of Computational Biology</em>, <em>24</em>(5), 422–435. doi: <a href="https://doi.org/10.1089/cmb.2016.0204">10.1089/cmb.2016.0204</a></p>
</div>
<div id="ref-Bocker2013">
<p>Böcker, S., Canzar, S., &amp; Klau, G. W. (2013). The generalized Robinson-Foulds metric. In A. Darling &amp; J. Stoye (Eds.), <em>Algorithms in bioinformatics. WABI 2013. Lecture notes in computer science, vol 8126</em> (pp. 156–169). doi: <a href="https://doi.org/10.1007/978-3-642-40453-5_13">10.1007/978-3-642-40453-5_13</a></p>
</div>
<div id="ref-Day1986">
<p>Day, W. H. (1986). Analysis of quartet dissimilarity measures between undirected phylogenetic trees. <em>Systematic Biology</em>, <em>35</em>(3), 325–333. doi: <a href="https://doi.org/10.1093/sysbio/35.3.325">10.1093/sysbio/35.3.325</a></p>
</div>
<div id="ref-Nye2006">
<p>Nye, T. M. W., Liò, P., &amp; Gilks, W. R. (2006). A novel algorithm and web-based tool for comparing two alternative phylogenetic trees. <em>Bioinformatics</em>, <em>22</em>(1), 117–119. doi: <a href="https://doi.org/10.1093/bioinformatics/bti720">10.1093/bioinformatics/bti720</a></p>
</div>
<div id="ref-TreeSearch">
<p>Smith, M. R. (2018). <em>TreeSearch: Phylogenetic Tree Search Using Custom Optimality Criteria</em>. doi: <a href="https://doi.org/10.5281/zenodo.1042590">10.5281/zenodo.1042590</a></p>
</div>
<div id="ref-Steel1993">
<p>Steel, M. A., &amp; Penny, D. (1993). Distributions of tree comparison metrics—some new results. <em>Systematic Biology</em>, <em>42</em>(2), 126–141. doi: <a href="https://doi.org/10.1093/sysbio/42.2.126">10.1093/sysbio/42.2.126</a></p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#desired-behaviour-of-tree-distance-metrics">Desired behaviour of tree distance metrics</a><ul class="nav nav-pills nav-stacked">
<li><a href="#moving-a-single-taxon">Moving a single taxon</a></li>
      <li><a href="#moving-two-taxa">Moving two taxa</a></li>
      <li><a href="#maximum-distance">Maximum distance</a></li>
      <li><a href="#unit-equivalence">Unit equivalence</a></li>
      <li><a href="#unresolved-trees">Unresolved trees</a></li>
      <li><a href="#conclusion">Conclusion</a></li>
      </ul>
</li>
      <li><a href="#improvements-to-partition-metrics">Improvements to partition metrics</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Martin R. Smith.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
